name: CI

on:
  push:
  pull_request:
    types: [opened, reopened]

defaults:
  run:
    shell: bash

jobs:
  CI:
    runs-on: ubuntu-latest
      
    steps:
    - name: Install gtest 
      run:  |
        cd /tmp/
        git clone https://github.com/google/googletest.git -b release-1.10.0
        cd googletest        # Main directory of the cloned repository.
        mkdir build          # Create a directory to hold the build output.
        cd build
        cmake ..             # Generate native build scripts for GoogleTest.
        make
        sudo make install    # Install in /usr/local/ by default
          
    - name: Checkout
      uses: actions/checkout@v2

    - name: Cache Qt
      id: cache-qt
      uses: actions/cache@v2
      with:
        path: ${{ runner.workspace }}/Qt
        key: ${{ runner.os }}-QtCache

    - name: Install Qt
      uses: jurplel/install-qt-action@v2
      with:
        cached: ${{ steps.cache-qt.outputs.cache-hit }}

    - name: Setup build environment
      run: |
        cmake -E make_directory ${{ github.workspace }}/build
        
    - name: Build All
      run: |
        cd ${{ github.workspace }}/build
        cmake  ..
        make
   
   #TODO
    - name: Run Unit Tests
      run: |       
        #cd ${{ github.workspace }}/Client_console/build
        #sudo ./CONSOLE
        
        #cd ${{ github.workspace }}/Server/build
        #sudo ./SERVER
        
        #cd ${{ github.workspace }}/lib/TCP/tests/build
        #sudo ./TCP
        
        #cd ${{ github.workspace }}/lib/Logger/tests/build
        #sudo ./Logger

        #cd ${{ github.workspace }}/lib/XML/tests/build
        #sudo ./XMLTEST
